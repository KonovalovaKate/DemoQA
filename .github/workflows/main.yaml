name: Cypress Tests

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]
  schedule:
    # Запуск каждую субботу в 00:00 UTC
    - cron: '0 0 * * 6'
  workflow_dispatch: # Позволяет запускать вручную кнопкой

jobs:
  eslint:
    runs-on: ubuntu-latest
    # Линтер работает ВСЕГДА (push, PR, schedule), кроме случаев, если вы хотите его тоже ограничить
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        # Используем install, так как у вас может не быть package-lock.json для команды ci
        run: npm install --save-dev eslint @eslint/js eslint-plugin-cypress

      - name: Run ESLint
        run: npx eslint cypress/

  cypress-run:
    # Оставляем зависимость, чтобы тесты не шли, если линтер упал
    needs: eslint
    # ВАЖНО: Это условие заставляет тесты запускаться ТОЛЬКО по расписанию
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    container:
      image: cypress/included:13.6.0
      options: --user 1001
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Cypress tests
        run: cypress run --browser chrome --headless